var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,c,b){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(c.call(b,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,b){a!=Array.prototype&&a!=Object.prototype&&(a[c]=b.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,c,b,d){if(c){b=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in b||(b[e]={});b=b[e]}a=a[a.length-1];d=b[a];c=c(d);c!=d&&null!=c&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:c})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6","es3");$jscomp.polyfill("Object.is",function(a){return a?a:function(a,b){return a===b?0!==a||1/a===1/b:a!==a&&b!==b}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(a,b){var c=this;c instanceof String&&(c=String(c));var e=c.length;b=b||0;for(0>b&&(b=Math.max(b+e,0));b<e;b++){var f=c[b];if(f===a||Object.is(f,a))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,c,b){if(null==a)throw new TypeError("The 'this' value for String.prototype."+b+" must not be null or undefined");if(c instanceof RegExp)throw new TypeError("First argument to String.prototype."+b+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,b){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,b||0)}},"es6","es3");slworld={};typeaheadWrapper={};
var SLWorld=function(){this.googleMapsWrapper=new GoogleMapsWrapper};
SLWorld.prototype.init=function(){this.fileUploader=new FileUploader;this.fileUploader.init("job-offer-picture","url","preview","progress");this.fileUploader.init("school-user-picture","url","preview","progress");this.fileUploader.init("new-school-picture","url","preview","progress");this.fileUploader.init("new-company-picture","url","preview","progress");this.fileUploader.init("new-company-logo","url","preview","progress");this.fileUploader.init("resume","url","preview","progress","fdb-label");this.ratingWrapper=
new Rating;this.ratingWrapper.init();this.googleMapsWrapper=new GoogleMapsWrapper;this.inputs=new InputController;this.inputs.init();this.searchFilterHandler=new SearchFilterHandler;this.searchFilterHandler.init();this.readMoreController=new ReadMore;this.readMoreController.init();this.schoolCreator=new SchoolCreator;this.schoolCreator.init();this.validator=new Validator;this.validator.init();this.stepperWizard=new Stepper;this.stepperWizard.init();this.typeaheadWrapper=typeaheadWrapper=new TypeaheadWrapper;
typeaheadWrapper.init()};slworld=new SLWorld;$(document).ready(function(){slworld.init()});
-1!=window.location.origin.indexOf("secondlanguage.world")&&(function(a,c,b,d,e,f,h){a.GoogleAnalyticsObject=e;a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)};a[e].l=1*new Date;f=c.createElement(b);h=c.getElementsByTagName(b)[0];f.async=1;f.src=d;h.parentNode.insertBefore(f,h)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-79825336-1","auto"),ga("send","pageview"));$(function(){$('[data-toggle="tooltip"]').tooltip()});
var FileUploader=function(){this.elements=[]};FileUploader.prototype.getElementIndex=function(a){var c=-1;this.elements.forEach(function(b,d){b.inputId==a&&(c=d)});return c};
FileUploader.prototype.init=function(a,c,b,d,e){var f=this;document.getElementById(a)&&(d={dom:$("#"+a),inputId:a,urlPrefix:c,previewPrefix:b,progressPrefix:d,currentPrefix:"current",fdbPrefix:e},this.elements.push(d),document.getElementById(a).onchange=function(){var b=document.getElementById(a).files[0];null==b?alert("No file selected."):(f.getSignedRequest(b,f.getElementIndex(a)),document.getElementById(c+"-"+a).value=b.name,document.getElementById("label-"+a).innerHTML=b.name)},document.getElementById(b+
"-"+a)&&(document.getElementById(b+"-"+a).onclick=function(){$("#"+a).trigger("click")}))};FileUploader.prototype.getSignedRequest=function(a,c){var b=this,d=new XMLHttpRequest;d.open("GET","/sign_s3?file_name="+a.name+"&file_type="+a.type);d.onreadystatechange=function(){if(4===d.readyState)if(200===d.status){var e=JSON.parse(d.responseText);b.uploadFile(a,c,e.signed_request,e.url)}else alert("Could not get signed URL.")};d.send()};
FileUploader.prototype.uploadFile=function(a,c,b,d){element=this.elements[c];var e=new XMLHttpRequest;e.open("PUT",b);e.setRequestHeader("x-amz-acl","public-read");e.upload.onprogress=function(a){a.lengthComputable&&(a=a.loaded/a.total*100,$("#"+element.progressPrefix+"-"+element.inputId).css("width",a+"%").attr("aria-valuenow",a))};e.onload=function(){if(200===e.status){var b=$("#"+element.previewPrefix+"-"+element.inputId),c=$("#"+element.currentPrefix+"-"+element.inputId),g=$("#"+element.fdbPrefix+
"-"+element.inputId);b.is("img")?(b.toggleClass("d-none"),b.attr("src","https://englishinchina.s3.amazonaws.com/"+d)):b.is("div")?b.css("background-image","url(https://englishinchina.s3.amazonaws.com/"+d+")"):g&&g.removeClass("d-none");c&&c.val(a.name);document.getElementById(element.urlPrefix+"-"+element.inputId).value=d;xhr2=new XMLHttpRequest;xhr2.open("POST","/pictureuploaded?url="+d+"&filename="+a.name+"&filesize="+a.size);4===xhr2.readyState&&(200===xhr2.status?(JSON.parse(xhr2.responseText),
alert("WORKED.")):alert("FAILED."));xhr2.send()}};e.onerror=function(a){alert("Could not upload file."+a)};e.send(a)};var GoogleMapsWrapper=function(){};
GoogleMapsWrapper.prototype.init=function(){if(document.getElementById("map")){var a=document.getElementById("map"),c=a.getAttribute("lat"),b=a.getAttribute("long"),d=a.getAttribute("address"),e=new google.maps.Map(a,{zoom:6,center:{lat:Number(c),lng:Number(b)}});(new google.maps.Geocoder).geocode({address:d},function(a,b){"OK"===b?(e.setCenter(a[0].geometry.location),new google.maps.Marker({map:e,position:a[0].geometry.location})):alert("Geocode was not successful for the following reason: "+b)})}};
var InputController=function(){};InputController.prototype.init=function(){this.initSliders();this.datepicker=$(".input-daterange").datepicker({format:"MM dd yyyy",autoclose:!0});this.initTinyMce();this.initRange()};InputController.prototype.initSliders=function(){var a=$(".slider"),c=$(".output");Array.prototype.filter.call(a,function(a,d){a.oninput=function(){c[d].innerHTML=this.value}})};
InputController.prototype.initDatePickers=function(){var a=window.location.pathname;$(".datepicker").pickadate({formatSubmit:"MMMM Do YYYY",onStart:function(){$("#start-date").removeAttr("readonly");$("#end-date").removeAttr("readonly");$("#date-of-birth").removeAttr("readonly")}});var c=$("#start-date").pickadate("picker"),b=$("#end-date").pickadate("picker"),d=$("#date-of-birth").pickadate("picker");c&&b&&(-1!=a.indexOf("review")?(c.set({min:new Date(2E3,1,1),max:Date.now()}),b.set({min:new Date(2E3,
1,1),max:365})):-1!=a.indexOf("job")&&(c.set({min:Date.now()}),b.set({min:Date.now(),max:1095})),c.on("set",function(a){a.select?b.set("min",c.get("select")):"clear"in a&&b.set("min",!1)}),b.on("set",function(a){a.select?c.set("max",b.get("select")):"clear"in a&&c.set("max",!1)}));d&&(d.set("min",new Date(1948,1,1)),d.set("max",-6570))};
InputController.prototype.initTinyMce=function(){$("#tinymce-textarea")&&tinymce.init({selector:"#tinymce-textarea",menubar:!1,style_formats:[{title:"Header",format:"h3"}],setup:function(a){a.on("change",function(){a.save()})},plugins:"link paste",toolbar:"link undo redo styleselect bold italic bullist numlist",paste_as_text:!0})};
InputController.prototype.initRange=function(){document.querySelectorAll(".nouirange").forEach(function(a){var c=document.createElement("div");c.setAttribute("id","#rangeHandler");var b=a.querySelector(".min"),d=a.querySelector(".max");b.style.display="none ";d.style.display="none ";var e=b.getAttribute("min"),f=d.getAttribute("max"),h=b.getAttribute("step");a.appendChild(c);noUiSlider.create(c,{pips:{mode:"count",values:5,density:5,stepped:!0},start:[b.value,d.value],connect:!0,step:Number(h),range:{min:Number(e),
max:Number(f)}});a=document.getElementById("salary-lower");b=document.getElementById("salary-higher");var g=[a,b];c.noUiSlider.on("update",function(a,b){g[b].value=a[b]});c.noUiSlider.on("change",function(a,b){$("#"+g[b].id).change()});g.forEach(function(a,b){a.addEventListener("change",function(){c.noUiSlider.setHandle(b,this.value)})})})};var Rating=function(){};Rating.prototype.init=function(){$(".rating").rate({readonly:!1});$(".rating").rate("destroy")};var ReadMore=function(){};
ReadMore.prototype.init=function(){$(".show-more-link").click(function(){$(".show-more-container").toggleClass("expand");$(".show-less-link").toggleClass("d-none");$(this).toggleClass("d-none");return!1});$(".show-less-link").click(function(){$(".show-more-container").toggleClass("expand");$(".show-more-link").toggleClass("d-none");$(this).toggleClass("d-none");return!1})};var SchoolCreator=function(){};
SchoolCreator.prototype.init=function(){this.initAddSchoolAjax();$("#citySelect").change(function(){""!=$(this).val()?$("#noSchool").prop("disabled",!1):$("#noSchool").prop("disabled",!0)})};SchoolCreator.prototype.addSchoolCallback=function(a){(a=JSON.parse(a))&&a._id&&a.name&&($("#queryInfo").val(a.name),$("#schoolId").val(a._id),$("#addSchoolCollapsible").collapse("hide"),$("#addSchoolCollapsible").collapse("dispose"),$("#noSchool").prop("disabled",!0),validateField($("#queryInfo")[0]))};
SchoolCreator.prototype.ajaxAddSchool=function(a){$.ajax({type:"POST",url:a,data:$("#add-school-form").serialize(),success:this.addSchoolCallback})};
SchoolCreator.prototype.initAddSchoolAjax=function(){0!=$("#addSchool").length&&($("#addSchoolCollapsible").on("shown.bs.collapse",function(){$("#provinceSelect").prop("required",!0);$("#citySelect").prop("required",!0)}),$("#addSchoolCollapsible").on("hidden.bs.collapse",function(){$("#provinceSelect").prop("required",!1);$("#citySelect").prop("required",!1)}),$("#add-school-form").submit(function(a){a.preventDefault();a.stopPropagation();a.currentTarget.checkValidity()?ajaxAddSchool("/school/addschool"):
alert("not valid")}),$("#addSchool").click(function(a){$("#add-school-form").submit()}))};
$(document).ready(function(){$(".chart").horizBarChart({selector:".bar",speed:1800});var a=$("#jumbotron-content").height()+100;$("#jumbotron-background").css("min-height",a);$("#school-header").css("min-height",a);$(window).on("resize",function(){var a=$("#jumbotron-content").height()+100;$("#jumbotron-background").css("min-height",a);$("#school-header").css("min-height",a)});$("#local-nav ul li a").click(function(a){a=a.currentTarget.getAttribute("href");$("html,body").animate({scrollTop:$(a).offset().top-
70},"slow")});$(document).on("click",'[data-toggle="lightbox"]',function(a){a.preventDefault();$(this).ekkoLightbox()});$(function(){$("#mdb-lightbox-ui").load("mdb-addons/mdb-lightbox-ui.html")});$("#ajax-add-photo").click(function(){var a=$("#schoolid").attr("value"),b=new XMLHttpRequest;b.open("GET","/school/addphotoajax/"+a);b.onreadystatechange=function(){if(4===b.readyState)if(200===b.status){$("#modal-body").empty();var a=JSON.parse(b.responseText);a=$($.parseHTML(a.html));$.each(a,function(a,
b){$(b).appendTo("#modal-body")});$("#modal").trigger("click");setUploadFile()}else alert("Problem.")};b.send()});$(document).on("click",".helpful",function(a){a=this.getAttribute("reviewid");var b=new XMLHttpRequest;b.open("POST","/school/helpfuls/0/"+a);b.onreadystatechange=function(){if(4===b.readyState)if(200===b.status){var a=JSON.parse(b.responseText);if("1"==a.result){var c=$($.parseHTML(a.html));$("#hf-"+a.reviewId).replaceWith(c)}}else alert("Problem.")};b.send()});$("#slw-modal").on("show.bs.modal",
function(a){a=$(a.relatedTarget);var b=a.data("reviewid");a.data("reviewuser");$("#modal-body").empty();var c=new XMLHttpRequest;c.open("GET","/school/reviews/"+b+"?ajax=true");c.onreadystatechange=function(){if(4===c.readyState)if(200===c.status){var a=JSON.parse(c.responseText);a=$($.parseHTML(a.html));$.each(a,function(a,b){$(b).appendTo("#modal-body")});$(".rating").rate({readonly:!1});$(".rating").rate("destroy");$(".chart").horizBarChart({selector:".bar",speed:1800})}else alert("Problem.")};
c.send();$(this).find(".modal-title").text("User Review")})});var SearchFilterHandler=function(){this.salary={};this.currentSearchQuery;this.startDateFrom;this.startDateTo;this.accomodation;this.airfare};
SearchFilterHandler.prototype.init=function(){if(document.getElementById("job-list")){var a=this;this.searchBox=$("#search-all");this.searchBox.input=$("#queryInfo");this.searchBox.submit(function(b){b.preventDefault();a.apply();return!1});$(".clear-filter").each(function(b){$(this).click(function(b){b.preventDefault();switch($(this).attr("data-filter-clear")){case "Salary":a.resetSalary(!0);break;case "Dates":a.resetDates(!0);break;case "Benefits":a.resetBenefits(!0);break;case "Class":a.resetClass(!0)}})});
$("#clear-all").click(function(b){a.resetAll();a.pushHistory();a.apply()});this.salary.lower=$("#salary-lower");this.salary.higher=$("#salary-higher");this.salary.handler=document.getElementById("#rangeHandler").noUiSlider;this.startDateFrom=$("#start-date-from");this.startDateTo=$("#start-date-to");this.accomodation=$("#accomodation");this.airfare=$("#airfare");$(".filter").each(function(b,c){$(this).change(function(b){a.pushHistory();a.apply()})});slworld.inputs.datepicker.on("hide",function(b){a.pushHistory();
a.apply()});window.onpopstate=function(b){a.apply();var c=window.location.href;b.state&&b.state.url&&(c=window.location.protocol+"//"+window.location.host+"/search"+b.state.url);if(b.state&&b.state.locationInfo)var e=b.state.locationInfo;a.updateFiltersUI(c,e)};setTimeout(a.updateDirtyState.bind(a),3E3);$(".typeahead").bind("typeahead:select",function(b,c){a.currentSearchQuery=c;a.pushHistory();a.apply()});var c=$("#clear-search");c&&c.click(function(){a.resetSearchBar(!0)})}};
SearchFilterHandler.prototype.updateDirtyState=function(){var a=window.location.pathname;history.state&&history.state.url&&(a=history.state.url);8<a.length?($("#filter-state-clean").addClass("d-none"),$("#filter-state-dirty").removeClass("d-none")):($("#filter-state-clean").removeClass("d-none"),$("#filter-state-dirty").addClass("d-none"));setTimeout(this.updateDirtyState.bind(this),1500)};
SearchFilterHandler.prototype.resetSearchBar=function(a){$(".typeahead").typeahead("val","");a&&(this.pushHistory(),this.apply())};SearchFilterHandler.prototype.resetSalary=function(a){this.salary.handler.set([5,25]);a&&(this.pushHistory(),this.apply())};SearchFilterHandler.prototype.resetBenefits=function(a){this.accomodation.val(-1);this.airfare.val(-1);a&&(this.pushHistory(),this.apply())};
SearchFilterHandler.prototype.resetDates=function(a){this.startDateFrom.val("");this.startDateTo.val("");a&&(this.pushHistory(),this.apply())};SearchFilterHandler.prototype.resetClass=function(a){};SearchFilterHandler.prototype.resetAll=function(){this.resetSalary(!1);this.resetBenefits(!1);this.resetDates(!1);this.resetClass(!1);this.pushHistory();this.apply()};
SearchFilterHandler.prototype.updateFiltersUI=function(a,c){a=(new URL(a)).searchParams;a.has("province")?$(".typeahead").typeahead("val",c.name+", China"):a.has("city")?$(".typeahead").typeahead("val",c.pinyinName):$(".typeahead").typeahead("val","");a.has("salaryLower")?this.salary.handler.set([Number(a.get("salaryLower"))/1E3,null]):this.salary.handler.set([5,null]);a.has("salaryHigher")?this.salary.handler.set([null,Number(a.get("salaryHigher"))/1E3]):this.salary.handler.set([null,25]);a.has("accomodation")?
this.accomodation.val(a.get("accomodation")):this.accomodation.val(-1);a.has("airfare")?this.airfare.val(a.get("airfare")):this.airfare.val(-1);a.has("startDateFrom")?this.startDateFrom.val(a.get("startDateFrom")):this.startDateFrom.val("");a.has("startDateTo")?this.startDateTo.val(a.get("startDateTo")):this.startDateTo.val("")};
SearchFilterHandler.prototype.pushHistory=function(){var a="?";""!=this.searchBox.input.val()&&this.currentSearchQuery&&("cities"==this.currentSearchQuery.type?a+="city="+this.currentSearchQuery.code+"&":"provinces"==this.currentSearchQuery.type&&(a+="province="+this.currentSearchQuery.code+"&"));-1!=this.accomodation.val()&&(a+="accomodation="+this.accomodation.val()+"&");-1!=this.airfare.val()&&(a+="airfare="+this.airfare.val()+"&");this.startDateFrom.val()&&(a+="startDateFrom="+this.startDateFrom.val()+
"&");this.startDateTo.val()&&(a+="startDateTo="+this.startDateTo.val()+"&");-1!=this.salary.lower.val()&&5!=Number(this.salary.lower.val())&&(a+="salaryLower="+1E3*this.salary.lower.val()+"&");-1!=this.salary.higher.val()&&25!=Number(this.salary.higher.val())&&(a+="salaryHigher="+1E3*this.salary.higher.val());"&"==a[a.length-1]&&(a=a.substring(0,a.length-1));history.pushState({url:a,locationInfo:this.currentSearchQuery},"page 2",a)};
SearchFilterHandler.prototype.apply=function(){var a=this;$("#loading-spinner").removeClass("d-none");$("#job-list").replaceWith('<div id="job-list"></div>');var c=function(b){a.updateDirtyState();$("#job-list").replaceWith(b);$("#loading-spinner").addClass("d-none")};history.state&&history.state.url?$.get(history.state.url+"&ajax=true",c):$.get("/search&ajax=true",c)};
var stepperInstance,Stepper=function(){stepperInstance=this;this.finalForm;this.contentSections;this.sectionForms;this.navigationButtons;this.currentStep=-1;this.nextButtons;this.prevButtons};
Stepper.prototype.init=function(){this.finalForm=$(".stepper form").not(".stepper-nested-forms form, .stepper-extra-forms form");this.contentSections=this.finalForm.children(".setup-content");this.navigationButtons=$(".stepper nav .step");this.sectionForms=$(".stepper .stepper-nested-forms form");this.navigationButtons.addClass("disabled");if(this.contentSections.length!=this.navigationButtons.length)throw Error("Number of navigation tabs is different from the number of sections");this.initContentSections();
this.initNavigationButtons();this.initSectionForms();this.initFlowButtons()};Stepper.prototype.returnStepForTarget=function(a,c){var b;$.each(a,function(a,e){e.isSameNode(c)&&(b=a)});return b};Stepper.prototype.toggleFormsToFromFinal=function(a){var c=stepperInstance;a+1==c.navigationButtons.length?$.each(c.sectionForms,function(a,d){a=$(d).attr("id");$("."+a).attr("form",c.finalForm.attr("id"))}):$.each(c.sectionForms,function(a,c){a=$(c).attr("id");$("."+a).attr("form",a)})};
Stepper.prototype.initFlowButtons=function(){this.nextButtons=$(".stepper .nextBtn");this.prevButtons=$(".stepper .prevBtn");this.prevButtons.click(function(){var a=stepperInstance;$(a.navigationButtons[a.currentStep-1]).trigger("click")});this.nextButtons.click(function(){var a=stepperInstance;$(a.navigationButtons[a.currentStep+1]).trigger("click")})};
Stepper.prototype.navButtonClick=function(a){var c=stepperInstance;a.preventDefault();a=c.returnStepForTarget(c.navigationButtons,a.currentTarget);a>c.currentStep?($(c.sectionForms[c.currentStep]).submit({wantedStep:a},c.runValidation),$(c.sectionForms[c.currentStep]).submit()):c.goToPage(a)};Stepper.prototype.runValidation=function(a){var c=stepperInstance;a.preventDefault();a.stopPropagation();a.currentTarget.checkValidity()&&($(c.navigationButtons[a.data.wantedStep]).removeClass("disabled"),c.goToPage(a.data.wantedStep))};
Stepper.prototype.goToPage=function(a){var c=stepperInstance;$(c.navigationButtons).removeClass("active");$(c.contentSections).hide();$(c.contentSections[a]).show();$(c.navigationButtons[a]).addClass("active");c.currentStep=a;c.toggleFormsToFromFinal(a);c.navigationButtons[a+1]&&$(c.navigationButtons[a+1]).removeClass("disabled");$("html,body").animate({scrollTop:$("#write-review-title").offset().top},"slow")};
Stepper.prototype.initContentSections=function(){var a=this;$.each(this.contentSections,function(c,b){b=$(b);b.attr("id","step-"+c);b.hasClass("active")?a.currentStep=c:b.hide()})};
Stepper.prototype.initNavigationButtons=function(){var a=this;$.each(this.navigationButtons,function(c,b){b=$(b);var d=b.children("a"),e="step-"+c;d.attr("id","step-"+c+"-indicator");d.attr("href",e);$(a.contentSections[c]).hasClass("active")?($(a.navigationButtons[c]).addClass("active"),b.removeClass("disabled")):0<c&&$(a.contentSections[c-1]).hasClass("active")&&b.removeClass("disabled")});a.navigationButtons.click(a.navButtonClick)};
Stepper.prototype.initSectionForms=function(){$.each(this.sectionForms,function(a,c){$(c).attr("id","form-"+a)})};$(document).ready(function(){$(".stepper form")&&(new Stepper).init()});
var resultList=!1,notFoundTemplate,currentQuery,currentSelection=void 0,datasetResultLimit=5,TypeaheadWrapper=function(){this.dataSources=[];this.totalResults={};this.autoTriggerValidation=!1;this.currentQueryCallback;this.currentQueryDatasets=[];var a=window.location.pathname;if(-1!=a.indexOf("review")||-1!=a.indexOf("job"))this.autoTriggerValidation=!0};
TypeaheadWrapper.prototype.init=function(){if(0!=$("#queryInfo").length){var a=$("#queryInfo").attr("datasets").valueOf().split(" ");typeaheadWrapper.initDatasets(a);if(!$("#queryInfo").attr("data-inline-search"))$("#search-all").on("submit",typeaheadWrapper.handleSubmit);(a=$("#clear-search"))&&a.click(function(){$(".typeahead").typeahead("val","")});$(".typeahead").typeahead({menu:$("#typeahead-target"),highlight:!0,minLength:2},typeaheadWrapper.dataSources).blur(function(){typeaheadWrapper.autoTriggerValidation&&
(slworld.validator.validateField($("#queryInfo")[0])||$("#noSchoolGroup").removeClass("d-none"))});$(".typeahead").bind("typeahead:select",function(a,b){$("#schoolId").val(b._id);currentSelection=b;$("#noSchool").prop("checked",!1);$("#addSchoolCollapsible").collapse("hide");$("#noSchoolGroup").addClass("d-none");typeaheadWrapper.autoTriggerValidation&&slworld.validator.validateField($("#queryInfo")[0]);console.log("typeahead")});$("#queryInfo").on("keyup",function(a,b,d,e){a=a.keyCode||a.which;37!=
a&&38!=a&&39!=a&&40!=a&&13!=a&&(typeaheadWrapper.autoTriggerValidation&&($("#schoolId").val(""),$("#noSchoolGroup").removeClass("d-none")),typeaheadWrapper.autoTriggerValidation&&(slworld.validator.validateField($("#queryInfo")[0]),$("#addSchoolName").val($(this).val())))});$("#queryInfo").click(function(a,b,d,e){/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(a=$("#queryInfo"),$("html,body").animate({scrollTop:$(a).offset().top-75},"slow"))});a=window.location.pathname;
-1==a.indexOf("review")&&-1==a.indexOf("job")&&$("#queryInfo").focus();(a=$("#queryInfo")[0])&&slworld.validator.validateField(a)}};
TypeaheadWrapper.prototype.initDatasets=function(a){var c=this;a.forEach(function(a){if("schools"==a){var b=c.createBloodhoundDataset("schools","/school/query","queryInfo");c.dataSources.push(c.createDataset("schools",20,b,"name",function(a){return"<div>"+a.name+', <span class="text-muted text-capitalize">'+a.province.name+", "+a.city.pinyinName+"</span></div>"}))}"jobs"==a&&(b=c.createBloodhoundDataset("jobs","/job/query","jobInfo"),c.dataSources.push(c.createDataset("jobs",5,b,"title",function(a){return"<div>"+
a.title+", China</span></div>"})));"provinces"==a&&(b=c.createBloodhoundDataset("provinces","/fetchprovinces","searchInfo"),c.dataSources.push(c.createDataset("provinces",5,b,"name",function(a){return"<div>"+a.name+"</span></div>"})));"cities"==a&&(a=c.createBloodhoundDataset("cities","/fetchcities","searchInfo"),c.dataSources.push(c.createDataset("cities",5,a,"pinyinName",function(a){return"<div>"+a.pinyinName+"</span></div>"})))})};
TypeaheadWrapper.prototype.createBloodhoundDataset=function(a,c,b){var d={};d.queryTokenizer=Bloodhound.tokenizers.whitespace;var e=function(a){return 0<a.list.length?(typeaheadWrapper.totalResults[a.query]=a.total,$.map(a.list,function(a){return a})):[]};if("schools"==a||"jobs"==a)d.datumTokenizer=function(a){return Bloodhound.tokenizers.whitespace(a.value)},d.remote={wildcard:"%QUERY",rateLimitWait:130,url:c,replace:function(a,c){-1!=$("#queryInfo").val()&&(a+="?"+b+"="+c);$("#provinceSelect")&&
(a+="&province="+$("#provinceSelect").val());$("#citySelect")&&(a+="&city="+$("#citySelect").val());return a+="&limit="+datasetResultLimit},transform:e};if("provinces"==a||"cities"==a)d.datumTokenizer=function(a){return a.pinyinName?Bloodhound.tokenizers.whitespace(a.pinyinName):Bloodhound.tokenizers.whitespace(a.name)},d.prefetch={url:c,cache:!1,transform:e};return new Bloodhound(d)};
TypeaheadWrapper.prototype.createDataset=function(a,c,b,d,e){return{limit:100,name:a,source:b,display:function(b){if(b){b.type=a;if("schools"==a)return b.name+", "+b.province.name+", "+b.city.pinyinName;if("jobs"==a)return b.title;if("cities"==a)return b.pinyinName+", "+b.province.name;if("provinces"==a)return b.name+", China"}},templates:{header:function(a){return'<div class="typeahead-header pl-3 pt-1">'+a.dataset+"</div>"},notFound:TypeaheadWrapper.prototype.notFoundTemplate.bind(this),suggestion:e,
footer:function(a){var b=a.dataset,c=a.suggestions.length,d='<div class="typeahead-footer text-small pl-3 py-1">Showing '+c+"/"+typeaheadWrapper.totalResults[b]+" "+b;if(c>=datasetResultLimit){switch(b){case "schools":d+=' - <a href="/search?queryInfo='+a.query+'">see all results</a></div>';break;case "jobs":d+=' - <a href="/search?queryInfo='+a.query+'">see all results</a></div>';break;case "provinces":d+=" - Try narrowing down your search</div>";break;case "cities":d+=" - Try narrowing down your search</div>"}return d}}}}};
TypeaheadWrapper.prototype.notFoundTemplate=function(a,c){c=a.query;a=a.dataset;var b=window.location.pathname,d=function(a){return['<div class="mx-2 text-small empty-message"><b>'+a+"</b></div>"]},e=function(a){return-1!=b.indexOf("review")?(this.autoTriggerValidation=!0,d('No school found for <span class="font-italic">'+a+"</span> (Check box below to proceed with school creation) ")):-1!=b.indexOf("job")?(this.autoTriggerValidation=!0,d('No school in our system for <span class="font-italic">'+a+
"</span> in the location specified")):d('No quick results found for <span class="font-italic">'+a+"</span> (Press Enter to search) ")};if(1==this.dataSources.length)return e(c);if(c===this.currentQueryCallback){if(this.currentQueryDatasets.push(a),this.currentQueryDatasets.length==this.dataSources.length)return e(c)}else this.currentQueryCallback=c,this.currentQueryDatasets=[],this.currentQueryDatasets.push(a)};
TypeaheadWrapper.prototype.handleSubmit=function(a){if(currentSelection)switch(a.preventDefault(),currentSelection.type){case "schools":window.location.href="/school/"+currentSelection._id;break;case "jobs":window.location.href="/job/"+currentSelection.url;break;case "provinces":window.location.href="/search?province="+currentSelection.code;break;case "cities":window.location.href="/search?city="+currentSelection.code}};
var replaceAtIndex=function(a,c,b){return a.substr(0,c)+b+a.substr(c+b.length)},initLazyLoading=function(){var a=[].slice.call(document.querySelectorAll(".lazy-background"));if("IntersectionObserver"in window){var c=new IntersectionObserver(function(a,d){a.forEach(function(a){if(a.isIntersecting){var b=a.target.style.backgroundImage.indexOf("th_");a.target.style.backgroundImage=replaceAtIndex(a.target.style.backgroundImage,b,"lg_");c.unobserve(a.target)}})});a.forEach(function(a){c.observe(a)})}};
$(document).ready(function(){function a(a){strVal="";a=a.split(" ");for(var b=0;b<a.length;b++)strVal+=a[b].substring(0,1).toUpperCase()+a[b].substring(1,a[b].length)+" ";return strVal}initLazyLoading();$("#splash-padding").height($("#search-navigation").height());$(window).resize(function(){$("#splash-padding").height($("#search-navigation").height())});$(".collapse-link").each(function(a){var b=$(this).attr("href");$(b).on("show.bs.collapse",function(){$(b+"-chevron").toggleClass("mdi-chevron-down");
$(b+"-chevron").toggleClass("mdi-chevron-up")});$(b).on("hide.bs.collapse",function(){$(b+"-chevron").toggleClass("mdi-chevron-down");$(b+"-chevron").toggleClass("mdi-chevron-up")})});$(function(){$('[data-toggle="tooltip"]').tooltip()});$(function(){$("#mdb-lightbox-ui").load("mdb-addons/mdb-lightbox-ui.html")});$("#collapsePhoto").on("show.bs.collapse",function(){$(".photos #show-more").toggleClass("d-none");$(".photos #show-less").toggleClass("d-none")});$("#collapsePhoto").on("hide.bs.collapse",
function(){$(".photos #show-more").toggleClass("d-none");$(".photos #show-less").toggleClass("d-none")});$("#collapseDescription").on("show.bs.collapse",function(){$(".description #show-more").toggleClass("d-none");$(".description #show-less").toggleClass("d-none")});$("#collapseDescription").on("hide.bs.collapse",function(){$("#show-more").toggleClass("d-none");$("#show-less").toggleClass("d-none")});$("#elicit-email").click(function(){var a=new XMLHttpRequest;a.open("GET","/login");a.onreadystatechange=
function(){if(4===a.readyState)if(200===a.status){$("#modal-body").empty();var b=$($.parseHTML(a.responseText));$.each(b,function(a,b){$(b).appendTo("#modal-body")});$("#slw-modal").modal("show");setUploadFile()}else alert("Problem.")};a.send()});if($("#main-header").hasClass("transparent")){var c=0;$(document).scroll(function(){c=$(this).scrollTop();1<c?($("#main-header").addClass("bg-white"),$("#main-header").removeClass("transparent")):($("#main-header").removeClass("bg-white"),$("#main-header").addClass("transparent"))})}$("#main-header").on("hide.bs.collapse",
function(){$("#main-header").addClass("collapsed")});$("#main-header").on("show.bs.collapse",function(){$("#main-header").removeClass("collapsed")});setTimeout(function(){$(".flash-messages-container ").fadeOut(2E3)},5E3);$("#citySelect.empty").prop("disabled","disabled");$("#provinceSelect").on("change",function(){$("#citySelect option:gt(0)").remove();$("#citySelect").prop("disabled","disabled");$("#citySelect").siblings("input").prop("disabled","disabled");$.ajax({url:"/cities/"+this.value,success:function(b){var c=
$("#citySelect");c.prop("disabled",!1);c.siblings("input").prop("disabled",!1);for(var e=0;e<b.length;e++)c.append($("<option></option>").attr("value",b[e].code).text(a(b[e].pinyinName)+" - "+b[e].chineseName));c.material_select("destroy");c.material_select()}})})});var Validator=function(){};Validator.prototype.init=function(){var a=this;$(".validate-form").each(function(c,b){b.noValidate=!0;$("#"+b.getAttribute("id")).submit(a.validateForm.bind(a))})};
Validator.prototype.validateForm=function(a){a=a?a:window.event;var c=a.target?a.target:a.srcElement,b,d=!0;for(b=0;b<c.elements.length;b++){var e=c.elements[b];if("INPUT"===e.nodeName||"TEXTAREA"===e.nodeName||"SELECT"===e.nodeName)this.validateField(e)||(d=!1)}d||a.preventDefault&&a.preventDefault();return d};
Validator.prototype.validateField=function(a){"undefined"!==typeof a.willValidate?("INPUT"===a.nodeName&&a.type!==a.getAttribute("type")&&a.setCustomValidity(this.legacyValidation(a)?"":"error"),this.isSpecialInput(a)&&a.setCustomValidity(this.validateSpecialInputs(a)?"":"error"),a.checkValidity()):(a.validity=a.validity||{},a.validity.valid=this.legacyValidation(a));var c=$("#"+a.getAttribute("id"));if(a.validity.valid)return c.addClass("valid"),c.removeClass("invalid"),!0;c.addClass("invalid");
c.removeClass("valid");return!1};Validator.prototype.isSpecialInput=function(a){var c=a.getAttribute("id");a=a.className.split(/\s+/);a.includes("mdb-select")&&(c="select-element");a.includes("date-field")&&(c="date-field");switch(c){case "schoolId":return!0;case "queryInfo":return!0;case "positionSelect":return!0;case "file_input":case "file_input2":case "job-offer-picture":return!0;case "date-field":return!0;case "select-element":return!0;case "tinymce-textarea":return!0;default:return!1}};
Validator.prototype.validateSpecialInputs=function(a){var c=!0,b=a.getAttribute("id"),d=a.className.split(/\s+/),e=b;d.includes("mdb-select")&&(e="select-element");d.includes("date-field")&&(e="date-field");if(!a.required)return!0;switch(e){case "date-field":""==a.value?($("#"+b).addClass("invalid"),$("#"+b).removeClass("valid"),c=!1):($("#"+b).addClass("valid"),$("#"+b).removeClass("invalid"));break;case "select-element":""==a.value?($("#"+b).siblings("input").addClass("invalid"),$("#"+b).siblings("input").removeClass("valid"),
c=!1):($("#"+b).siblings("input").addClass("valid"),$("#"+b).siblings("input").removeClass("invalid"));break;case "file_input":case "file_input2":case "job-offer-picture":""==a.value?($(".file-path").addClass("invalid"),$(".file-path").removeClass("valid"),c=!1):($(".file-path").addClass("valid"),$(".file-path").removeClass("invalid"));break;case "queryInfo":d=$("#"+b).siblings("#schoolId");""==a.value?($("#"+b).addClass("invalid"),$("#"+b).removeClass("valid"),c=!1):""==d.val()?($("#"+b).addClass("invalid"),
$("#"+b).removeClass("valid"),c=!1):($("#"+b).addClass("valid"),$("#"+b).removeClass("invalid"));break;case "tinymce-textarea":""==a.value?($("#"+b).siblings(".mce-tinymce").addClass("invalid"),$("#"+b).siblings(".mce-tinymce").removeClass("valid"),c=!1):($("#"+b).siblings(".mce-tinymce").addClass("valid"),$("#"+b).siblings(".mce-tinymce").removeClass("invalid"))}return c};
Validator.prototype.legacyValidation=function(a){var c=!0,b=a.value,d=a.getAttribute("type");d="checkbox"===d||"radio"===d;var e=a.getAttribute("required"),f=a.getAttribute("minlength"),h=a.getAttribute("maxlength"),g=a.getAttribute("pattern");if(a.disabled)return c;(c=(c=c&&(!e||d&&a.checked||!d&&""!==b))&&(d||(!f||b.length>=f)&&(!h||b.length<=h)))&&g&&(g=new RegExp(g),c=g.test(b));return c};